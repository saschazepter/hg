image: octobus/ci-mercurial-core

# The runner made a clone as root.
# We make a new clone owned by user used to run the step.
before_script:
    - hg clone . /tmp/mercurial-ci/ --noupdate
    - hg -R /tmp/mercurial-ci/ update `hg log --rev '.' --template '{node}'`
    - cd /tmp/mercurial-ci/

variables:
    PYTHON: python

.runtests_template: &runtests
    script:
        - cd tests/
        - echo "python used, $PYTHON"
        - $PYTHON run-tests.py --color=always --time test-check-*.*

checks-py2:
    <<: *runtests

checks-py3:
    <<: *runtests
    variables:
        PYTHON: python3
